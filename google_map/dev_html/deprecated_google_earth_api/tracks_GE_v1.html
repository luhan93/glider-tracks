<!-- tracks3d.html 
Modified from Google Earth API Examples for Multiple Glider Tracks 
http://earth-api-samples.googlecode.com/svn/trunk/examples/kml-fetch-checkboxes.html

loads kml generated by parsing localuser mail for current surface fix, glider mission and
other info wanted to display on google earth

Used Goggle Earth so we can add other layers and data via kml files 
Can scale icons in Google Earth and not in Google Maps.
Can use time and ocean views.

You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <!-- Refresh the page every 1800 seconds (30 minutes) -->
    <meta http-equiv="Refresh" content="1800; url=http://dockserver.marine.unc.edu/realtime/tracks/" />
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="./css/styles.css"></link>
    <title>Glider Tracks</title>
   <script type="text/javascript" src="https://www.google.com/jsapi?key=ABQIAAAA747JuuldtzBnLspWkFFDeBSgCKDHVpFgZ1Nng_oNKKqex1JsFBSi5tYx5nsf6PGk-9RU9O4N-cyitw"> </script>
    <script type="text/javascript">
      function addSampleButton(caption, clickHandler) {
        var btn = document.createElement('input');
        btn.type = 'button';
        btn.value = caption;
        
        if (btn.attachEvent)
          btn.attachEvent('onclick', clickHandler);
        else
          btn.addEventListener('click', clickHandler, false);

        // add the button to the Sample UI
        document.getElementById('sample-ui').appendChild(btn);
      }
      
      function addSampleUIHtml(html) {
        document.getElementById('sample-ui').innerHTML += html;
      }
    </script>
    <script type="text/javascript">
    var ge;
    
    // store the object loaded for the given file... initially none of the objects
    // are loaded, so initialize these to null
    var currentKmlObjects = {
      'ramses': null,
      'pelagia': null
    };
    
    google.load("earth", "1");
    
    function init() {
      google.earth.createInstance('map3d', initCallback, failureCallback);
    
      addSampleUIHtml(
        '<input type="checkbox" id="kml-ramses-check" onclick="toggleKml(\'ramses\');"/><label for="kml-ramses-check">Ramses </label><br/>' +
        '<input type="checkbox" id="kml-pelagia-check" onclick="toggleKml(\'pelagia\');"/><label for="kml-pelagia-check">Pelagia </label><br/>'
      );
    }
    
    function initCallback(instance) {
      ge = instance;
      ge.getWindow().setVisibility(true);
    
      // add a navigation control
      ge.getNavigationControl().setVisibility(ge.VISIBILITY_AUTO);
    
      // add some layers
      ge.getLayerRoot().enableLayerById(ge.LAYER_BORDERS, true);
      ge.getLayerRoot().enableLayerById(ge.LAYER_ROADS, true);
    
	// fly instantly to position
	ge.getOptions().setFlyToSpeed(ge.SPEED_TELEPORT);  

	// fly to Long Bay, NC
  	var lb = ge.createLookAt('');
  	lb.set(33.12, -78.3,
    	0, // altitude
    	ge.ALTITUDE_ABSOLUTE,
    	0, // heading
    	0, // straight-down tilt
    	200000 // range (inverse of zoom)
    	);

	// fly to Tower R2 SKIO, GA
  	var r2 = ge.createLookAt('');
  	r2.set(31.375, -80.567,
    	0, // altitude
    	ge.ALTITUDE_ABSOLUTE,
    	0, // heading
    	0, // straight-down tilt
    	50000 // range (inverse of zoom)
    	);

	ge.getView().setAbstractView(r2);

      // if the page loaded with checkboxes checked, load the appropriate
      // KML files
      if (document.getElementById('kml-ramses-check').checked)
        loadKml('ramses');
    
      if (document.getElementById('kml-pelagia-check').checked)
        loadKml('pelagia');
    
      document.getElementById('installed-plugin-version').innerHTML =
        ge.getPluginVersion().toString();
    }
    
    function failureCallback(errorCode) {
    }
    
    function toggleKml(file) {
      // remove the old KML object if it exists
      if (currentKmlObjects[file]) {
        ge.getFeatures().removeChild(currentKmlObjects[file]);
        currentKmlObject = null;
      }
    
      // if the checkbox is checked, fetch the KML and show it on Earth
      var kmlCheckbox = document.getElementById('kml-' + file + '-check');
      if (kmlCheckbox.checked)
        loadKml(file);
    }
    
    function loadKml(file) {
      var kmlUrl = 'http://dockserver.marine.unc.edu/realtime/tracks/' +
        file + '_track.kml';
    
      // fetch the KML
      google.earth.fetchKml(ge, kmlUrl, function(kmlObject) {
        // NOTE: we still have access to the 'file' variable (via JS closures)
    
        if (kmlObject) {
          // show it on Earth
          currentKmlObjects[file] = kmlObject;
          ge.getFeatures().appendChild(kmlObject);
	  if (kmlObject.getAbstractView())
	      ge.getView().setAbstractView(kmlObject.getAbstractView());

        } else {
          // bad KML
          currentKmlObjects[file] = null;
    
          // wrap alerts in API callbacks and event handlers
          // in a setTimeout to prevent deadlock in some browsers
          setTimeout(function() {
            alert('Bad or null KML.');
          }, 0);
    
          // uncheck the box
          document.getElementById('kml-' + file + '-check').checked = '';
        }
      });

     // listen for click on the window (look specifically for point placemarks)
     google.earth.addEventListener(ge.getWindow(), 'click', function(event) {
       if (event.getTarget().getType() == 'KmlPlacemark' &&
           event.getTarget().getGeometry().getType() == 'KmlPoint') {
         // prevent default ballon
         event.preventDefault();

         // var text = 'cliked on an ICon Placemkarker';
         var text = event.getTarget().getDescription();
	 showInContentWindow(text);
      }

     // wrap alerts in API callbacks and event handlers
     // in a setTimeout to prevent deadlock in some browsers
     // setTimeout(function() {
     //  alert(text);
     // }, 0);

     });

     function showInContentWindow(text) {
       var sidediv = document.getElementById('content_window');
       sidediv.innerHTML = text;

     }	

    }
    
    </script>
  </head>
  <body onload="init()" style="font-family: arial, sans-serif; font-size: 13px; border: 0;">
    <h3>Glider Tracks:</h3>
    <div style="clear: both;"></div>
  
    <div id="ui" style="position: relative;">
       <div id="sample-ui"></div>
       <div id="map3d" style="height: 750px; width: 700px; float:left"></div>
       <div id="content_window" style="position: absolute; left: 720px; top: 0;">
	  <h3>Surface Report:</h3> 
       </div> 
    </div>
    <dl><dt>Installed Plugin Version:</dt><dd id="installed-plugin-version">...</dd></dl>

  </body>
</html>